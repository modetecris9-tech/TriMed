<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Lista de Pacientes</title>
<link rel="stylesheet" href="{{ url_for('static', filename='index.css') }}">
</head>
<body>
<h1>Pacientes cadastrados</h1>

{% with mensagens = get_flashed_messages(with_categories=True) %}
  {% if mensagens %}
  <ul class="flashes">
    {% for categoria, msg in mensagens %}
      <li class="flash {{ categoria }}"><strong>{{ categoria }}:</strong> {{ msg }}</li>
    {% endfor %}
  </ul>
  {% endif %}
{% endwith %}

<form method="get" action="{{ url_for('lista') }}">
  <input type="text" name="q" placeholder="Buscar por CPF ou nome" value="{{ q }}">
  <button type="submit">Buscar</button>
</form>

<p>{{ pacientes|length }} paciente(s)</p>

{% if pacientes %}
<table>
  <thead>
  <tr><th>CPF</th><th>Nome</th><th>Ações</th></tr>
  </thead>
  <tbody>
  {% for p in pacientes %}
    <tr>
      <td>{{ p['cpf']|format_cpf }}</td>
      <td>{{ p['nome'] }}</td>
      
      <td>
        {% if not p['cpf'].startswith('cpf temporario-') %}
          <a href="{{ url_for('paciente', cpf=p['cpf']) }}">Editar</a> |
        {% endif %}
        <a href="{{ url_for('deletar', cpf=p['cpf']) }}">Excluir</a> |
        <a href="{{ url_for('medico_paciente', cpf=p['cpf']) }}">Receitar / Atestar</a>|
        <a href="{{ url_for('questionario', cpf=p['cpf']) }}">Questionário</a>|
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% else %}
<p>Nenhum paciente cadastrado.</p>
{% endif %}

<p><a href="{{ url_for('index') }}">Voltar ao início</a></p>

<style>
table { border-collapse: collapse; width: 100%; max-width: 800px; }
th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
th { background:#f5f5f5; }
.flashes { list-style:none; padding:0; margin:8px 0; }
.flashes .flash { padding:8px; border-radius:4px; margin:6px 0; }
.flashes .warning { background:#fff3cd; border:1px solid #ffeeba; }
.flashes .success { background:#d4edda; border:1px solid #c3e6cb; }
</style>
</body>
</html>